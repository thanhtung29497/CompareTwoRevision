FROM docker-virtual.artifactory.srv.hq.mendix.net/alpine-make-nodejs-5:latest
MAINTAINER jos.huiting@mendix.com

ARG NPM_TOKEN

# Install dependencies, use a temp directory to benefit from docker caching
COPY package.json /tmp/package.json

#Download dependencies if the package.json has changed, cleanup build-time dependencies afterwards
RUN echo "//registry.npmjs.org/:_authToken=${NPM_TOKEN}" >> /tmp/.npmrc && \
    cat /tmp/.npmrc && \
    cd /tmp && \
    npm install && \
    mkdir -p /opt/app/model-sdk && \
    cp -a /tmp/node_modules /opt/app/model-sdk/ && \
    rm -rf /tmp /root/.npm

COPY . /opt/app/model-sdk
WORKDIR /opt/app/model-sdk


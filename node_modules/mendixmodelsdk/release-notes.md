# Release notes Mendix Model SDK

# 3.0.3

| story# | impact | description |
|---|---|---|
|  1053700 | None | Fixed an issue with internal properties being accidentally included in the typings. |

# 3.0.2

| story# | impact | description |
|---|---|---|
|  1053700 | None | Add support for Modeler version 7.0.1 (including betas). |

# 3.0.1

| story# | impact | description |
|---|---|---|
|  984713 | Low | Idempotent splices in listy part properties are recognized and do nothing (instead of potentially breaking the model). |
| 1000316 | None | Unresolved by-name references are now reported as part of running checks on a unit. |
| 983574 | Low | The `deploy` operation has been deprecated and is replaced by `startAppUpdate` and `getAppUpdateStatus`. Similarly, `getDeploymentStatus` has been superseded by `getAppEnvironmentStatus` (Low impact, as deployment cannot be used for SDK created projects) |

Note: impact = low mean "some code might work now".

## 3.0.0

| story# | impact | description |
|---|---|---|
| 1006697 | High | _Breaking change:_ The MxCheck `follow` construct has been split in `followExcl` and `followIncl` (removing the original). |
| 1006275 | High | _Breaking change:_ `moduleName` has been removed from the `(I)ModelUnit` type - use `qualifiedName` (from `(I)AbstractElement`) instead. |
|  975440 | Low | All NPM dependencies now have a caret version range, so that they can play along as peer dependencies of downstreams. |
| 984704, 989914, 994955 | Low | Fixed several problems with moving an element around between containers. |
| 1003394 | Low | Fixed a problem with not being able to fix unresolvable by-name references. |
|  973322 | None | Added a `.move(from, to)` method to properties containing multiple structures (such a `pages.VerticalFlow.widgets`). |
|  975180 | None | More tslint-compliance in (generated) TypeScript source code. |
|  832688 | None | Added possibility of deleting model units (such as Pages). |
|  954811 | None | Fixed a problem with extraneous traffic to the Model API. |
| 1001001 | None | Re-exposed the `AbstractProperty` type. (Reverts a breaking API change introduced in one of the other stories related to moving elements.) |
| 1012394 | None | Internal improvement w.r.t. success/error handling in raw deployment. |
|  956735 | None | Add support for Modeler version 7.0.0 (including betas). |
| 986517, 857001 | None | Added checks for WM release. |

Ad 832688: You do this by using `splice` on the container of a model unit; e.g.:

```
const deleteIndex = page.container.documents.indexOf(page);
page.container.documents.splice(deleteIndex, 1);
```

Note: impact = low mean "some code might work now".


## 2.9.1
| story# | impact | description |
|---|---|---|
| 964698 | None | Fixed several problems with moving elements around between containers. |


## 2.9.0
| story# | impact | description |
|---|---|---|
| 953686 | None | Exposed `checks.validateNameSyntax` method to be able to validate a name (e.g. a Page name) syntactically. |
| 950591 | None | Added support for Mendix 6.10.0. |


## 2.8.1

| story# | impact | description |
|---|---|---|
| 944926 | Low | Fixed `metaModelVersion` in `AbstractModel` to actually contain meta model version instead of Mendix product version (which is now stored in `mxVersionForModel`). |
| 933681 | None | Added checks for Page name validation (syntax + uniqueness); includes fixes to MxCheck. |
| 933784 | None | Fixed order of meta model versions mentioned in documentation and error messages. |
| 900258 | None | Updated links to reference the updated documentation site. |


## 2.8.0

| story# | impact | description |
|---|---|---|
| 888671 | Low | From this release on but *retro-actively for all Mendix model versions*, the `microflowCall` property of an `MicroflowCallAction` element is required instead of optional. |
| 917703 | None | Added support for Mendix 6.9.0. |


## 2.7.0

| story# | impact | description |
|---|---|---|
| 877891 | None | Support for Mendix 6.7.1 and 6.8.0. |
| 875733 | None | Prevent exceptions being thrown while deep copying model content with empty by-name references (which is a model inconsistency). |


## 2.6.3

| story# | impact | description |
|---|---|---|
| 877059 | Fix | Fixed Model SDK for published `mendixmodelsdk` missing `dist/`. |


## 2.6.2

| story# | impact | description |
|---|---|---|
| 876423 | Fix | Fixed Model SDK for `npm install mendixmodelsdk` failing on version 2.6.1. |

**Note!** This version (2.6.2) has been unpublished from NPM with all changes carried over to version 2.6.3.


## 2.6.1

| story# | impact | description |
|---|---|---|
| 844466, 856402, 847209, 856825 | None | Add support -that's only accessible for trusted backend clients!- for providing a project-to-working copy mapping, locking/unlocking working copies and extra meta data regarding merge requests. |
| 864245 | None | Widened a parameter type in internal interfaces and classes to fix a problem with using the Model SDK in a Safari browser. |
| 863993 | None | Refactored MxCheck expression AST hierarchy. |
| 822836 | None | `deploy` API now returns an additional field, `startedFullDeployment`, which is `false` if the app was fast-deployed (and completed now), or `true` if a full deployment was needed and further status of the app can be polled through `deployStatus` calls. |
| 852489 | None | Exposed `mergeState` in the working copy's meta data. Added `loadWorkingCopyMetaData` to SDK client to obtain it's meta info without opening it. Exposed `Version` utility class. |
| 849093 | None | Fixed/extended SDK documentation for the `sortIndex` attribute of `Module`. (Ticket #466184) |
| 872575 | None | Replaced use of Grunt build system with `npm`. |
| 880618 | None | Closing the connection no longer fails silently after an error has occurred. |

**Note!** This version (2.6.1) has been unpublished from NPM with all changes carried over to version 2.6.3.


## 2.6.0

| story# | impact | description |
|---|---|---|
| 847916, 846458 | None | Support for Mendix 6.7.0. |


## 2.5.0

| story# | impact | description |
|---|---|---|
| 823084 | Low  | `getFilePaths` has been deprecated and renamed to `getFiles`. |
| 822820 | Low  | Improved the typings of some (internal) APIs. |
| 823084 | None | `getFilePaths` accepts an option objects which can define `format` (either `zip` or `json`), `filter` (glob pattern) and `path` (output filename if format is `zip`). |
| 823084 | None | Output filename is no longer mandatory for `getFile` / `getFiles` / `exportMpk`. If not provided, raw response is provided in the callback instead. |
| 716682 | None | Support for forcing full deployment. Deploying a working copy is functionality that's not accessible to regular Model SDK users (i.e. non-trusted backends), so no impact. |
| 721821 | None | More (complete) support for running model checks from the SDK. |
| 808118 | None | Corrected implementation of check level groups. |
| 821075 | None | Fixed a bug with delete deltas not being sent while they should - this e.g. caused 2 translations to be created for the title text of a new page, with the translations having the same language code. |
| 821069 | None | Renamed `hasPrefix` standard library method for expressions (checks and queries) to `startsWith`. |
| 821101 | None | Support for Mendix 6.6.0. |


## 2.4.0

| story# | impact | description |
|---|---|---|
| 790285 | None | Support for Mendix 6.5.1. |
| 692298 | None | Exposed facilities for running consistency checks on models. |


## 2.3.0

| story# | impact | description |
|---|---|---|
| 697458 | Low | Support for Mendix 6.5.0. |


## 2.2.2

| story# | impact | description |
|---|---|---|
| 684928 | None | Added support for Mendix 6.4.1. |
| 678039 | Low | It is now possible to deep clone elements by using `element.deepCopy()` |
| 678039 | Low | SerializeToJs no longer crashes when it encounters deleted attributes |
| 678031 | Low | Added publicReadOnly property for working copies |
| 673596 | Low | Added support for retrieving overviews of all the working copies that user is member of |


## 2.1.0

| story# | impact | description |
|---|---|---|
| 662135 | Minor | Added support for Mendix 6.4.0 |
| 649171 / 623912 | Low | Working copies that are connected to sprintr projects can now be deployed and their runtime status can be requested |
| 659702 | Low | Unit-loading now has an extra optional forceRefresh option. If set, it will then bypass the Mendix MOdel SDK cache, and get the fresh unit straight from the source/server.
| 675290 | Minor | All classes that could be useful for reflection on the model are now exposed through `mendixmodelsdk`, so imports from `mendixmodelsdk/dist/sdk/internal/...` should no longer be needed. |
| 675290 | Minor | Private members (starting with an underscore `_`) where not available in the docs but where available in the public typings and therefor in the IDE's. This has been fixed. It should not ever be necessary to ever access these members. But if you did access them, you now need to access the object to `any` first before the typechecker allows you to access these members. The method `allProperties()` is now available on all structures for reflection purposes. |


## 2.0.0

This release introduces a number of breaking changes in the SDK's API, so because of semantic versioning we need to up the major version.

| story# | impact | description |
|---|---|---|
| 612773 | High | The mechanics of model elements being contained has been reworked: see below for more details. |
| 634662 | Low | The `toPlainJson` method on elements and units has been renamed to `toJSON`, because e.g. the Chrome Developer Tools understand this to produce nice, human-readably representations of such objects. Rename all usages of `toPlainJson` to `toJSON` to fix your code. |
| 639825 | Low | Broken by-name references are automatically fixed when a target is added to the model again. |
| 637545 | None | Minor internal modifications for upcoming Mendix version 6.3.0. |
| 633932 | None | Added support for long-lived working copies (that are not deleted after 24 hours) to SDK. Note that this is currently **not** available to non-trusted backends! |
| 620108 | None | Removed exported interface `IObservable` from an internal namespace and replaced its use by the one from the `MObservable` library. |
| 631960 | None | Added support for checking deployment status. |
| 623906 | None | Added support for deploying from the SDK. Note that this is currently **not** supported on non-trusted backends! |

The following **breaking** changes are made per 612773 and as a result of new insights on interference between containment and versioning/history of the Mendix modelling language.
This interference leads to elements having different kinds of containment throughout their history.
In turn, this necessitated us to make some fundamental changes to avoid having to have breaking changes in the future.

* The `container` property is not strictly typed anymore; e.g., `domainmodels.Attribute.container` is not of type `Entity` anymore but of a general `Container` type.
* Instead, `containerAs<T>` properties of type `T` are introduced on all elements.
    This property returns the instance of `T` which contains the element or throws if it's not contained by an instance of `T`.
    To avoid those exceptions, use `container` together with `instanceof`-guards.
* In case an element is contained by _multiple_ properties (i.e., more than 1), `createIn<T>Under<P>` methods are generated which creates a new element in a given instance of `T` under property `P`.
    Several previously-existing `createIn` methods have been replaced by a `createIn<T>Under<P>` method, where these `createIn` methods considered only 1 containing property.
* Elements that are contained by one property in at least one version will have a `createIn` method that works as expected for those versions and throws for other versions.
* Elements that are always (i.e., in all versions) contained by properties that are derived, will not have any `createIn...` methods.

Dependent code can be easily fixed by using the `containerAs<T>` property instead of the `container` property,
    and (in a few specific cases) by using a `createIn<T>Under<P>` method instead of the `createIn` method.


## 1.2.0

| story# | impact | description |
|---|---|---|
| 619692 | Low | Added/triggered TypeDoc for `create` and `createIn` methods. Also fixed incorrect behavior for `create` method of `DatabaseConstraint` from 6.1.0 onwards. |
| 623947 | None | Added support for Mendix version 6.2.0. |
| 612773 | None | Minor rework w.r.t. story #619692. |


## 1.1.1

| story# | impact | description |
|---|---|---|
| 615031, 610152 | Low | Fixed issue where the SDK would have very high CPU usage and throw timeouts for a reasonable amount of requests. |
| 617263 | Low | The File API calls are accessible for working-copy members now. |
| 610152 | Low | Improved parsing of model elements in the SDK for better performance. |
| 614997 | None | Fixed internal-only test meta model, used for unit tests. |


## 1.1.0

| story# | impact | description |
|---|---|---|
| 600896 | Low | Various meta model updates *for Mendix version 6.1.0* - see below. |

The following changes are made per 600896 and pertain exclusively to models made with Mendix version 6.1.0 and higher:

* Introduced a new modelling construct `SelectorDatabaseSource` for pages.
* `DatabaseConstraint` cannot be created directly in a `DatabaseSourceBase` instance anymore.
    Instead, use the `create` method of `DatabaseConstraint` and assign the instance explicitly to a suitable container,
    i.e. `databaseConstraints` of either an instance of (a sub type of) `DatabaseSourceBase` or `SelectorDatabaseSource`.
* These properties have been deleted, so should not be accessed on models with Mendix version 6.1.0 and higher:
    * `systemEntityType` of both `MsdMicroflow` and `MsdMicroflowParameter`,
	* `parameterTypeName` of `ExportMapping`, and
	* `allowSimpleMappingInheritance` of `OperationInfo`.


## 1.0.2

This release replaces all previous SDK versions as our API endpoints have been changed and finalized.
Please run `npm update mendixmodelsdk --save`.

| story# | impact | description |
|---|---|---|
| 585226 | High | All Model API infrastructure has been moved to Europe and the default endpoint of the API is updated. |
| 602450 | Low | SDK now throttles requests to avoid spamming our servers. This might degrade performance a little. |
| 606647 | None | SDK now handles EPIPE errors coming from AWS correctly. |

## 1.0.1

| story# | impact | description |
|---|---|---|
| 600261 | None | Updated the SDK for version 6.0.1 of the Mendix Business Modeler. |
| 593338 | Low | Fixed race condition which occurred sometimes when opening a project. |

## 1.0.0

| story# | impact | description |
|---|---|---|
| 561960 | High | All constructors to create new model elements are removed, instead factory methods should be used. The migration is straight forward: `var entity = new domainmodels.Entity()` becomes: `var entity = domainmodels.Entity.create(model)`. See the next paragraph for more details. |
| 562069 | Medium | Versioning has been added explicitly, so usage of elements and properties is checked against the product (and hence meta model) version. As part of this, `new ModelSdkClient(..)` is no longer valid and has to be replaced with `Model.createSdkClient(..)` everywhere. |
| 569299 | Low | Introduction / deprecation / deletion messages for structures / elements / properties are shown in the typescript documentation.
| 581572 | Low | Improved error-message when trying to use an unloaded element or property.
| 580561 | Low | An error-message will be returned, when using an out-dated Mendix Model SDK. Only Mendix Model SDK 1.0.0-rc.0 and up are supported now.
| 588942 | Low | Stability improvements when creating new project
| 561960 | Low | It is no longer possible to push `null` or items twice onto a properties that contain a list of elements. |
| 561960 | Low | It is no longer possible to instantiate objects that are derived, such as `LayoutParameter`. |
| 561960 | Low | All model elements expose a `.model` property that returns the model they belong to. |
| 561960 | Low | Convenience methods to create elements and add them to a parent directly are introduced for all elements that are stored at a unique place (this holds for most elements except for utilities like `texts.Text`). See the next paragraph for more details. |
| 553639 | Low | The Model API and SDK observe the same rules for setting properties to `null` as the Business Modeler does: (1) list properties cannot receive `null` at all, (2) non-list properties can only be set to `null` if they are are object-typed (i.e., not primitive or enum) and not required (see documentation). |
| 561972 | Low | It is no longer possible to move a model element from one model to another. In other words: model elements can only exist within the model they were created in. |
| 562069, 561977, 568908 | None | The SDK is now versioned in the sense that structures and properties can have lifecycles, moving from `not yet introduced` to `introduced` to `deprecated` to `deleted` depending on which version of the Mendix Business Modeler was used to create (the MPK for) the working copy. The SDK provides suitable warnings or errors (once per structure/property per connection) on the console whenever a structure or property is used that is either not yet introduced, deprecated or deleted. |
| 463511* | Low | Finding images by qualified name now works, so e.g. `pages.StaticImageViewer.image` isn't always `null`. |
| 585563 | Low | Stability improvements when uploading large files. |
| 583025 | Low | `Structure#traverse` now checks whether the structure has been loaded and fails if not. You have to pre-load traversed structures first if not done already. |
| 585492 | Low | Updated the Model SDK for latest (RC-)version of Business Modeler, i.e. |
| 590510 | None | Extended the Model SDK with file operations. |
| 591741 | None | Improved build process. |
| 564149 | None | The Model SDK now ships with a separate "mini-SDK" that is exclusively used for unit testing the SDK itself. |
| 463511* | None | `IStructure`, `IList`, `IAbstractUnit` and `IEnum` are now (by request) exposed again on top-level. |
| 463511* | None | `Structure` has a new method called `traverse` to (synchronously) traverse this structure and all contained (not referenced) structures - see its TypeDoc for more information. |

### Introducing structure factories

In this release we moved from argument less constructors to factory methods. This has a few advantages:
1. We can perform more consistency checks upfront, such as whether the type you are creating is available in the Mendix version of your project.
2. Factories can be overloaded in many more ways than constructors, this allows us to introduce even more convenience factories in the future.

So if you had:
```javascript
function newEntity(domainModel: domainmodels.DomainModel, name: string) {
	var entity = new domainmodels.Entity();
	domainModel.entities.push(entity);
	entity.name = name;

	return entity;
}
```

This will become:

```javascript
function newEntity(domainModel: domainmodels.DomainModel, name: string) {
	var entity = domainmodels.Entity.create(domainModel.model); // all factories need to know about the owning model
	domainModel.entities.push(entity);
	entity.name = name;

	return entity;
}
```

This seems to make it less convenient to make new structures. However, we introduced convenience factory methods that automatically create new elements _and_ registers them on their parent.
So from this release onward you can just write:

```javascript
function newEntity(domainModel: domainmodels.DomainModel, name: string) {
	var entity = domainmodels.Entity.createIn(domainModel); // pass the domainModel instead of a model
	entity.name = name;

	return entity;
}
```

You will notice that this significantly reduces the amount of boilerplate code in application generators.


## 0.8.1

(Previous release: 0.0.1)

The following stories (/features) have been implemented after release 0.0.1 and are part of the 0.8.1 release.
The _impact_ column pertains to how code _using_ the Model SDK could have to be changed due to that story being implemented.
(Order is from high to low impact.)

| story# | impact | description |
|---|---|---|
| 505983 | high | The Model API now checks SDK, API and product versions against each other. The user must upgrade her Mendix project to one of the supported product versions (which are: 5.20, 5.21) in order to be able to work with it, and to upgrade the SDK version to be able to continue working with the API. |
| 552385 | high | The structure of the TypeScript code for the Model SDK has been changed significantly, to be able to make use of the improved module system of TS 1.6. Among other things, the reliance on DefinitelyTyped has been removed: instead, typings are imported through the CommonJS `require` primitive. The user should change the setup to reflect that, notably, all `/// <reference ... ` imports that refer to the sdk need to be removed. The intermediate namespace `sdk` has been removed, the modules `configuration` and `utils` now live at toplevel. The `extras` namespace has been merged into `utils`. The `internal` namespace is no longer exposed, any imports relying on `internal` can now be imported directly from the toplevel.
| 545083 | medium | Working copies always have an expiry date (defaults to 1 day), after which the working copy will be removed from the Model API Server. |
| 561682 | medium | "to serialize" is now consistently written with US spelling, so the user has to change `utils.serialiseToJs` to `utils.serializeToJs`. Also: `Structure.toPlainJson()` now works reflectively, leading to a reduction of the footprint of the SDK code. |
| (no #) | medium | Various refinements have been implemented in the SDK to ensure that models created with it can be opened in the Mendix Business Modeler after export. In some cases, this may cause the user's code to behave slightly different than before - e.g., captions may be generated with two `en_US` translations, one of them empty. |
| 527667 | low | Various refinements have been implemented in the SDK to ensure that required property values cannot be unset by assigning `null` to the property. This is now checked by the SDK before calling the API and triggering an error there, so the user will have early feedback about this and no chance to corrupt models. |
| 551509 | low | The SDK now checks that by-id references can only point to elements/structures in the same unit. |
| 559461 | low | Classes that previously were documented as being abstract/non-instantiable are now really that (using TypeScript 1.6's new `abstract` modifier). |
| 554074 | low | Properties' values can only be written to when the unit is fully-loaded. |
| 553258 | none | Improvements to Model SDK build process. |
| 546717 | none | The default value of properties of type `DateTime` has been changed to `Date.now()` - the only such property is `startDateTime` of `ScheduledEvent` (in the `scheduledevents` namespace). |
| 551534 | none | The TypeScript Docs are now explicitly versioned with the current/latest being the default. |
| 551527 | none | Duplicate but unused SDK code has been removed. |
| 541576 | none | The MIT License has been applied to the SDK. |
| 530354 | none | The to Model SDK-JavaScript code serialiser has been improved in various ways. |
| 530125 | none | Generated documentation has been improved. |
| 554498 | none | Unit tests (for the Model SDK that existed outside that) have been moved into this repository. |
| 552385 | none | Generated documentation has been improved. |
| 560833 | none | Fixed an issue where the chrome debugger might crash while inspecting data. |


## Impact rating

An impact rated as "low" means (for this release) that execution of the user's code may stop prematurely, but that in that case the user could have been generating corrupt or inconsistent models with the previously-released version.

('*' means: fixed during this story, but not intrinsically related to this story)


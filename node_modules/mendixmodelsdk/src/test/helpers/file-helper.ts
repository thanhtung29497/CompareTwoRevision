import {writeFile, readFileSync} from "fs";
import mkdirp = require("mkdirp");


// relative to 'mendixmodelsdk/':
const outputPathPrefix = "test-output/";
export const testDataPathPrefix = "./src/test/data/";

const encodingOpts = { encoding: "utf-8" };


/**
 * Writes the given JSON under the given file name into the test-output directory.
 */
export function writeJson(fileName: string, json: Object) {
	mkdirp(outputPathPrefix, /* trigger default: */ null, err => {
		if (err) {
			console.warn(`could not create path '${outputPathPrefix} for test output`);
		} else {
			writeFile(outputPathPrefix + fileName, JSON.stringify(json, null, 4), encodingOpts, err => {
				if (err) {
					console.warn(`could not write JSON to '${outputPathPrefix}${fileName}' due to: ${err}`);
				} else {
					console.log(`wrote JSON to ${outputPathPrefix}${fileName}`);
				}
			});
		}
	});
}


/**
 * Reads the file with the given name relative to 'mendixmodelsdk',
 * and parses and returns it as JSON.
 */
export function readJson<T>(fileName: string): T {
	return JSON.parse(readFileSync(fileName, encodingOpts)) as T;
}

